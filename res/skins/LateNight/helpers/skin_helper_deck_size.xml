<!--
Description:

    A three-state GUI switch
    Depending on how the following skin controls are combined
    [Master],maximize_library
    [Master],show_mixer
    [LateNight],selected_deck_size
    [Skin],select_minimal_decks
    it picks the appropriate deck variant
    FULL | Compact | minimal

    A SizeAwareStack and WidgetStack hack that basically executes
    an analogue version of a simple script like this:

    if (![Master],maxmimize_library
          && [Skin],select_minimal_deck) {
        hide(fullDeck);
        hide(compactDeck);
        show(minimaldeck);
    } else {
      if ([Master],show_mixer) {
        hide(minimaldeck);
        hide(compactDeck);
        show(fullDeck);
      } else {
        case ..
        ...
      }
    }

    This is a fixed-width container. The occupied space is defined
    by widget connected to the above controls. The SizeAwareStack
    then picks one fitting child widget.
    Note: To make the whole thing work we need to be sure there's
    only ONE fitting widget for every possible size the
    SizeAwareStack could be shrunk to.

    Each widget inside the SizeAwareStack is a WidgetStack.
    By default, WidgetStacks pick their first child for display*,
    then -optionally- toggle the child's trigger control to '1.
    Example:
    <WidgetStack>
      <Children>
        <WidgetGroup trigger="[Any],config_key">  => set to '1'
        <WidgetGroup trigger="[Another],config_key">  => set to '0'
      </Children>
    </WidgetStack>
    The interesting part is: trigger="" works 2-way. If for example
    [Another],config_key is set to '1' the respective WidgetStack
    index is shown, others are hidden. The other way around, if you
    show a previously hidden WidgetStack this will toggle the first
    child's trigger control.

    So, let's put several copies of a WidgetStack into the
    SizeAwareStack, each with the identical set of children and
    controls. If we then change the order of the WidgetStacks'
    children, each WidgetStack can toggle a specific control to '1'
    while setting the others to '0'.
    If we've set the parent SizeAwareStack up carefully, and if we
    omitted storing the index with
    <WidgetStack currentPage="[Save],config_key"> anywhere inside
    the SizeAwareStack, we can now toggle several N-state switches
    at once.
    This gives us a pretty reliable tool to pick the appropriate
    deck variant, for example, depending on a may-be complex
    skin configuration.
-->

<Template>
  <!-- Extra wrapper so we can put multiple, independent size
  detectors in here.
  The height is zero, so this doesnt't even consume GUI space. -->
  <WidgetGroup>
    <Size>0me,0f</Size>
    <Layout>vertical</Layout>
    <Children>

      <!-- Deck selector.
            Picks the approriate deck size for display. -->
      <WidgetGroup>
        <Layout>horizontal</Layout>
        <Size>3f,0f</Size>
        <Children>

          <!-- Widgets that define the remaining space,
                visibility connected to skin controls -->
          <WidgetGroup>
            <Connection>
              <ConfigKey>[Master],show_mixer</ConfigKey>
              <Transform><Not/></Transform>
              <BindProperty>visible</BindProperty>
            </Connection>
            <Layout>horizontal</Layout>
            <Children>

              <WidgetGroup><!-- Full deck selected -->
                <Size>3f,0f</Size>
                <Connection>
                  <ConfigKey persist="true">[LateNight],selected_deck_size</ConfigKey>
                  <Transform><IsEqual>0</IsEqual></Transform>
                  <BindProperty>visible</BindProperty>
                </Connection>
              </WidgetGroup>

              <WidgetGroup><!-- Compact deck selected -->
                <Size>2f,0f</Size>
                <Connection>
                  <ConfigKey persist="true">[LateNight],selected_deck_size</ConfigKey>
                  <Transform><IsEqual>1</IsEqual></Transform>
                  <BindProperty>visible</BindProperty>
                </Connection>
              </WidgetGroup>

              <WidgetGroup><!-- minimal deck selected -->
                <Size>1f,0f</Size>
                <Connection>
                  <ConfigKey persist="true">[LateNight],selected_deck_size</ConfigKey>
                  <Transform><IsEqual>2</IsEqual></Transform>
                  <BindProperty>visible</BindProperty>
                </Connection>
              </WidgetGroup>

            </Children>
          </WidgetGroup>

          <WidgetGroup>
            <Size>3f,0f</Size>
            <Connection>
              <ConfigKey persist="true">[Master],show_mixer</ConfigKey>
              <BindProperty>visible</BindProperty>
            </Connection>
          </WidgetGroup>
          <!-- /Widgets that define the remaining space,
                visibility connected to skin controls -->

          <!-- Deck size detector -->
          <SizeAwareStack>
            <Children>
              <!-- Full deck: full deck is selected or
                               the mixer is shown -->
              <WidgetStack>
                <SizePolicy>me,f</SizePolicy>
                <MinimumSize>0,0</MinimumSize>
                <MaximumSize>0,0</MaximumSize>
                <Children>
                  <WidgetGroup trigger="[LateNight],show_full_deck"></WidgetGroup>
                  <WidgetGroup trigger="[LateNight],show_compact_deck"></WidgetGroup>
                  <WidgetGroup trigger="[LateNight],show_minimal_deck"></WidgetGroup>
                </Children>
              </WidgetStack>

              <!-- Compact deck is selected -->
              <WidgetStack>
                <SizePolicy>me,f</SizePolicy>
                <MinimumSize>1,0</MinimumSize>
                <MaximumSize>1,0</MaximumSize>
                <Children>
                  <WidgetGroup trigger="[LateNight],show_compact_deck"></WidgetGroup>
                  <WidgetGroup trigger="[LateNight],show_full_deck"></WidgetGroup>
                  <WidgetGroup trigger="[LateNight],show_minimal_deck"></WidgetGroup>
                </Children>
              </WidgetStack>

              <!-- Minimal deck: minimal deck is selected or
                                  the library is maximized-->
              <WidgetStack>
                <SizePolicy>me,f</SizePolicy>
                <MinimumSize>2,0</MinimumSize>
                <MaximumSize>2,0</MaximumSize>
                <Children>
                  <WidgetGroup trigger="[LateNight],show_minimal_deck"></WidgetGroup>
                  <WidgetGroup trigger="[LateNight],show_compact_deck"></WidgetGroup>
                  <WidgetGroup trigger="[LateNight],show_full_deck"></WidgetGroup>
                </Children>
              </WidgetStack>
            </Children>
          </SizeAwareStack><!-- /Size detector -->

        </Children>
      </WidgetGroup>
      <!-- checks which deck size should be displayed -->
    </Children>
  </WidgetGroup>
</Template>
